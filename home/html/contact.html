<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoLab: Contact Us</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/Timeseries.css">
</head>
<body class="min-h-screen">
    <!-- Navbar -->
    <!-- <nav class="navbar bg-gradient-to-r from-blue-600 to-indigo-600 p-4 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-2xl font-bold text-white">CryptoLab</div>
            <ul class="flex space-x-6">
                <li><a href="/frontend/home/html/dashboard.html" class="text-white">Home</a></li>
                <li><a href="/frontend/home/html/Fetchdata.html" class="text-white">Fetch Data</a></li>
                <li><a href="/frontend/home/html/forcasting.html" class="text-white">Forecasting</a></li>
                <li><a href="/frontend/home/html/Timeseries.html" class="text-white">Time Series</a></li>
                <li><a href="/frontend/home/html/About.html" class="text-white">About</a></li>
                <li><a href="/frontend/home/html/contact.html" class="text-white">Contact</a></li>
                <li>
                    <button id="logout-btn" class="text-white hover:text-gray-300 transition">
                        <img src="https://cdn-icons-png.flaticon.com/512/1828/1828479.png" alt="Logout Icon" class="w-6 h-6"/>
                    </button>
                </li>
            </ul>
        </div>
    </nav> -->

    <nav class="navbar bg-gradient-to-r from-blue-600 to-indigo-600 p-4 sticky top-0 z-50 shadow-lg">
    <div class="container mx-auto flex justify-between items-center">
        <div class="text-2xl font-bold text-white">CryptoLab</div>
        <ul class="flex space-x-6">
            <li><a href="/frontend/home/html/dashboard.html" class="text-white text-lg hover:text-gray-300 transition">Home</a></li>
            <li><a href="/frontend/home/html/Fetchdata.html" class="text-white text-lg hover:text-gray-300 transition">Fetch Data</a></li>
            <li><a href="/frontend/home/html/forcasting.html" class="text-white text-lg hover:text-gray-300 transition">Forecasting</a></li>
            <li><a href="/frontend/home/html/Timeseries.html" class="text-white text-lg hover:text-gray-300 transition">Time Series</a></li>
            <li><a href="/frontend/home/html/About.html" class="text-white text-lg hover:text-gray-300 transition">About</a></li>
            <li><a href="/frontend/home/html/contact.html" class="text-white text-lg hover:text-gray-300 transition">Contact</a></li>
            <li>
                <button id="logout-btn" class="text-white hover:text-gray-300 transition" aria-label="Logout">
                    <img src="https://cdn-icons-png.flaticon.com/512/1828/1828479.png" alt="Logout Icon" class="w-6 h-6"/>
                </button>
            </li>
        </ul>
    </div>
</nav>

    <!-- Contact Section -->
    <section class="py-12 bg-gray-900">
        <div class="container mx-auto px-4">
            <h2 class="text-4xl font-bold text-white text-center mb-10">Contact Us</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                <!-- Contact Info -->
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <h3 class="text-2xl font-semibold text-white mb-4">Get in Touch</h3>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                            <p class="text-gray-300">+91 8793306218</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                            <p class="text-gray-300">vasugadde0203@gmail.com</p>
                        </div>
                    </div>
                </div>
                <!-- Contact Form -->
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <h3 class="text-2xl font-semibold text-white mb-4">Send Us a Query</h3>
                    <div id="contact-form-container">
                        <div class="space-y-4">
                            <div>
                                <label for="name" class="block text-gray-300 mb-1">Name</label>
                                <input type="text" id="name" name="name" required class="w-full bg-gray-700 text-white border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="email" class="block text-gray-300 mb-1">Email</label>
                                <input type="email" id="email" name="email" required class="w-full bg-gray-700 text-white border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="query" class="block text-gray-300 mb-1">Your Query</label>
                                <textarea id="query" name="query" required rows="4" class="w-full bg-gray-700 text-white border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            <button type="button" id="submit-query" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-md hover:from-blue-700 hover:to-indigo-700 transition">Submit</button>
                        </div>
                    </div>
                    <div id="success-message" class="hidden text-green-400 text-center mt-4">
                        Query submitted successfully! We'll get back to you soon.
                    </div>
                    <div id="error-message" class="hidden text-red-400 text-center mt-4">
                        Failed to submit query. Please try again.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Logout Modal -->
    <div id="logout-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 transition-opacity duration-300">
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full transform scale-95 transition-transform duration-300">
            <h3 class="text-lg font-semibold text-gray-100 mb-4">Do you want to logout?</h3>
            <div class="flex justify-end space-x-4">
                <button id="logout-cancel" class="px-4 py-2 bg-gray-600 text-gray-100 rounded-md hover:bg-gray-500 transition">No</button>
                <button id="logout-confirm" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-md hover:from-blue-700 hover:to-indigo-700 transition">Yes</button>
            </div>
        </div>
    </div>

    <!-- Chatbot Icon -->
    <div id="chatbot-icon" class="fixed bottom-6 right-6 w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer shadow-lg hover:bg-blue-700 transition">
        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712027.png" alt="Chat Icon" class="w-8 h-8"/>
    </div>

    <!-- Chatbot Container -->
    <div id="chatbot-container" class="chatbot-container flex">
        <div class="chatbot-header">
            <h3>Crypto Assistant</h3>
            <button id="chatbot-close">×</button>
        </div>
        <div id="chatbot-messages" class="chatbot-messages">
            <div class="chatbot-message bot">Hello! I'm here to help with your crypto questions. What would you like to know?</div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbot-input" placeholder="Ask a question about crypto..." autocomplete="off">
            <button id="chatbot-send">Send</button>
        </div>
    </div>

    <script>
        // Logout Modal Functionality
        const logoutBtn = document.getElementById('logout-btn');
        const logoutModal = document.getElementById('logout-modal');
        const logoutCancel = document.getElementById('logout-cancel');
        const logoutConfirm = document.getElementById('logout-confirm');

        logoutBtn.addEventListener('click', () => {
            logoutModal.classList.remove('hidden');
        });

        logoutCancel.addEventListener('click', () => {
            logoutModal.classList.add('hidden');
        });

        logoutConfirm.addEventListener('click', () => {
            localStorage.removeItem('access_token');
            window.location.href = '/frontend/home/html/login.html';
        });

        // Contact Form Submission
        const submitQueryBtn = document.getElementById('submit-query');
        const formContainer = document.getElementById('contact-form-container');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');

        submitQueryBtn.addEventListener('click', async () => {
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const query = document.getElementById('query').value.trim();

            if (!name || !email || !query) {
                errorMessage.textContent = 'Please fill all required fields.';
                errorMessage.classList.remove('hidden');
                successMessage.classList.add('hidden');
                return;
            }

            try {
                const response = await fetch('http://localhost:8000/contact/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email, query })
                });

                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

                formContainer.classList.add('hidden');
                successMessage.classList.remove('hidden');
                errorMessage.classList.add('hidden');
            } catch (error) {
                errorMessage.textContent = 'Failed to submit query. Please try again.';
                errorMessage.classList.remove('hidden');
                successMessage.classList.add('hidden');
            }
        });

        // Chatbot Functionality
        const chatbotIcon = document.getElementById('chatbot-icon');
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatbotClose = document.getElementById('chatbot-close');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSend = document.getElementById('chatbot-send');

        chatbotIcon.addEventListener('click', () => {
            const isVisible = chatbotContainer.style.display === 'flex';
            chatbotContainer.style.display = isVisible ? 'none' : 'flex';
            if (!isVisible) {
                chatbotInput.focus();
                scrollToBottom();
            }
        });

        chatbotClose.addEventListener('click', () => {
            chatbotContainer.style.display = 'none';
        });

        chatbotSend.addEventListener('click', sendMessage);

        chatbotInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        });

        function formatResponse(text) {
            function escapeHTML(str) {
                return str.replace(/&/g, '&amp;')
                          .replace(/</g, '&lt;')
                          .replace(/>/g, '&gt;')
                          .replace(/"/g, '&quot;')
                          .replace(/'/g, '&#39;');
            }
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            const paragraphs = text.split(/\n\n/).filter(p => p.trim() !== '');
            let html = '';
            let inOrderedList = false;
            let inUnorderedList = false;
            let currentListItems = [];

            paragraphs.forEach(paragraph => {
                const lines = paragraph.split('\n').filter(line => line.trim() !== '');
                let paragraphHTML = '';
                lines.forEach((line, index) => {
                    const numberedMatch = line.match(/^\d+\.\s*(.+)/);
                    const bulletMatch = line.match(/^\-\s*(.+)/);
                    const continuationMatch = line.match(/^\s{2,}(.+)/);

                    if (numberedMatch) {
                        if (inUnorderedList) {
                            paragraphHTML += `<ul>${currentListItems.join('')}</ul>`;
                            currentListItems = [];
                            inUnorderedList = false;
                        }
                        if (!inOrderedList) {
                            inOrderedList = true;
                        }
                        currentListItems.push(`<li>${escapeHTML(numberedMatch[1])}</li>`);
                    } else if (bulletMatch) {
                        if (inOrderedList) {
                            paragraphHTML += `<ol>${currentListItems.join('')}</ol>`;
                            currentListItems = [];
                            inOrderedList = false;
                        }
                        if (!inUnorderedList) {
                            inUnorderedList = true;
                        }
                        currentListItems.push(`<li>${escapeHTML(bulletMatch[1])}</li>`);
                    } else if (continuationMatch && (inOrderedList || inUnorderedList)) {
                        const lastItemIndex = currentListItems.length - 1;
                        if (lastItemIndex >= 0) {
                            currentListItems[lastItemIndex] = currentListItems[lastItemIndex].replace(
                                '</li>',
                                ` ${escapeHTML(continuationMatch[1])}</li>`
                            );
                        }
                    } else {
                        if (inOrderedList) {
                            paragraphHTML += `<ol>${currentListItems.join('')}</ol>`;
                            currentListItems = [];
                            inOrderedList = false;
                        } else if (inUnorderedList) {
                            paragraphHTML += `<ul>${currentListItems.join('')}</ul>`;
                            currentListItems = [];
                            inUnorderedList = false;
                        }
                        paragraphHTML += `<p>${escapeHTML(line)}</p>`;
                    }

                    if (index === lines.length - 1) {
                        if (inOrderedList) {
                            paragraphHTML += `<ol>${currentListItems.join('')}</ol>`;
                            inOrderedList = false;
                            currentListItems = [];
                        } else if (inUnorderedList) {
                            paragraphHTML += `<ul>${currentListItems.join('')}</ul>`;
                            inUnorderedList = false;
                            currentListItems = [];
                        }
                    }
                });

                html += paragraphHTML;
            });

            return html || '<p>No content available.</p>';
        }

        async function sendMessage() {
            const query = chatbotInput.value.trim();
            if (!query) return;

            const userMessage = document.createElement('div');
            userMessage.className = 'chatbot-message user';
            userMessage.textContent = query;
            chatbotMessages.appendChild(userMessage);

            chatbotInput.value = '';
            scrollToBottom();

            const loadingMessage = document.createElement('div');
            loadingMessage.className = 'chatbot-message bot loading';
            chatbotMessages.appendChild(loadingMessage);
            scrollToBottom();

            try {
                const token = localStorage.getItem('access_token');
                if (!token) throw new Error('No access token found');

                const response = await fetch('http://localhost:8000/chat/query', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query })
                });

                if (!response.ok) throw new Error(`Chatbot API error: ${response.status}`);
                const data = await response.json();

                loadingMessage.remove();
                const botMessage = document.createElement('div');
                botMessage.className = 'chatbot-message bot';
                botMessage.innerHTML = formatResponse(data.answer || 'Sorry, I couldn’t find an answer to that.');
                chatbotMessages.appendChild(botMessage);
            } catch (error) {
                loadingMessage.remove();
                const errorMessage = document.createElement('div');
                errorMessage.className = 'chatbot-message bot';
                errorMessage.textContent = 'Error: Unable to get a response. Please try again.';
                chatbotMessages.appendChild(errorMessage);
            }

            scrollToBottom();
        }

        function scrollToBottom() {
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }
    </script>
</body>
</html>